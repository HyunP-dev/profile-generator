<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>트친소 생성기</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="style.css" rel="stylesheet" />

    <script>
        class Item {
            constructor(title, content) {
                this.title = title
                this.content = content
            }
        }

        class HeaderItem extends Item { }

        class BodyItem extends Item { }

        class Bar { }

        class Card {
            constructor(canvas) {
                canvas.width = 900
                canvas.height = 500

                this.canvas = canvas
                let ctx = canvas.getContext("2d")
                ctx.textBaseline = "top"

                ctx.fillStyle = "white"
                ctx.fillRect(0, 0, 900, canvas.height)

                ctx.fillStyle = "#3873b3"
                ctx.fillRect(0, 0, 225, canvas.height)
                this.ctx = ctx

                this.items = []
            }

            setProfilePicture(src) {
                const img = new Image()
                img.crossOrigin = "anonymous"
                img.addEventListener("load", () => {
                    this.ctx.drawImage(img, 28, 28, 225 - 28 * 2, 225 - 28 * 2)
                })
                img.src = src
            }

            addItem(item) {
                let ctx = this.ctx

                let header_count = this.items.filter(item => item instanceof HeaderItem).length
                let body_count = this.items.length - header_count

                let index = item instanceof HeaderItem ? header_count : body_count
                this.print(index, item)
                
                this.items.push(item)
            }

            print(index, item) {
                const HEADER_TOP = 200
                let ctx = this.ctx
                let color = "#3873b3"

                if (item instanceof HeaderItem) {
                    ctx.fillStyle = "white"
                    ctx.fillRect(28, 27 + HEADER_TOP + 80 * index, 5, 24)

                    ctx.font = "bold 24px Apple SD Gothic Neo"
                    ctx.fillText(item.title, 43, 25 + HEADER_TOP + 80 * index)

                    ctx.font = "22px Apple SD Gothic Neo"
                    ctx.fillText(item.content, 43, 60 + HEADER_TOP + 80 * index)
                }
                if (item instanceof BodyItem) {
                    ctx.fillStyle = color
                    ctx.font = "bold 24px Apple SD Gothic Neo"
                    if (item.title) {
                        ctx.fillRect(255, 32 + 40 * index, 5, 24)
                        ctx.fillText(item.title, 270, 30 + 40 * index)
                    }
                    ctx.fillStyle = "black"
                    ctx.font = "24px Apple SD Gothic Neo"
                    ctx.fillText(item.content, 460, 30 + 40 * index)
                }
                if (item instanceof Bar) {
                    ctx.fillStyle = color
                    ctx.fillRect(255, 32 + 40 * index + 10, 615, 1)
                }
            }

            refresh() {
                ctx.fillStyle = "white"
                ctx.fillRect(0, 0, 900, canvas.height)


            }
        }

        

        window.onload = () => {

            const canvas = document.querySelector("canvas")
            const card = new Card(canvas)

            card.setProfilePicture("https://avatars.githubusercontent.com/u/85296811?v=4")

            let items = [
                new HeaderItem("닉네임", "박현"),
                new HeaderItem("나이", "성인"),
                new HeaderItem("거주지", "서울시 동대문구"),
                new BodyItem("주 필드", "소프트웨어 개발, 디지털 포렌식"),
                new BodyItem("취미", "애니 덕질, 코스프레 촬영, 리듬게임,"),
                new BodyItem("", "작곡, 피아노 연주, 바이올린 연주"),
                new Bar(),
                new BodyItem("좋아하는 게임", "프로젝트 세카이"),
                new BodyItem("좋아하는 애니", "Steins;Gate"),
                new BodyItem("좋아하는 장르", "SF, 공포"),
                new BodyItem("좋아하는 캐릭터", "      미즈키"),
                new Bar(),
                new BodyItem("트위터 활동 성향", "일상 트윗, 일러 / 사진 맘찍"),
                new BodyItem("지뢰", "싸움 only")
            ]
            items.forEach(item => card.addItem(item))

            let ctx = card.ctx

            const characterImage = new Image()
            characterImage.crossOrigin = "anonymous"
            characterImage.addEventListener("load", () => {
                ctx.drawImage(characterImage, 460, 30 + 40 * 7 - 2, 28, 28)
            })
            characterImage.src = "./150px-Mizuki-circle.webp"

            var link = document.getElementById('link')
            link.setAttribute('download', '트친소.png')

            document.querySelector("#exportBtn").onclick = () => {
                link.setAttribute('href', canvas.toDataURL("image/png").replace("image/png", "image/octet-stream"))
                link.click()
            }
        }
    </script>
</head>

<body>
    <header>
        <h1>트친소 생성기</h1>
        <button id="exportBtn"><i class="fa-solid fa-download"></i></span>
    </header>
    <canvas></canvas>
    <a id="link"></a>
    <br>
    <div id="edits">
        <label>닉네임</label><br>
        <input />
        <label>나이</label><br>
        <input />
        <label>거주지</label><br>
        <input />
    </div>
</body>

</html>